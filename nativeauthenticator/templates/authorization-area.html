{% extends "page.html" %}

{% block script %}
{{ super() }}
<script>
	function copyToClipBoard() {
	  var tokenText = document.getElementById("currentToken");
	  var baseText = document.getElementById("url_input");
	  var urlText = document.getElementById("url_suffix");
	  navigator.clipboard.writeText(baseText.value + urlText.textContent + tokenText.textContent);
	}
</script>
{% endblock script %}

{% block main %}
<div class="container">
    <h1>Authorization area</h1>
    
    {% if signup_disabled %}
    <h3>Signup Tokens</h3>
    <p>General signup is currently disabled. If you wish to let individual users sign up anyway, give them the signup URL below. It will be valid until three days from now.</p>
    <div>
        <p><label for="url_input">Your URL base: </label><input style="margin-left:5px" type="text" id="url_input"><samp style="margin-left:5px" id="url_suffix">{{signup_url}}</samp><br/></p>
        <p><label for="currentToken">Token: </label><samp style="margin-left:5px" id="currentToken">{{signup_token}}</samp></p>
        <p></p>
        <button class="btn btn-jupyter" onClick="copyToClipBoard();">Copy complete signup URL</button>
        <!-- reloading the page gives new token -->
    	<button class="btn btn-jupyter" onClick="window.location.reload();">Generate new signup URL</button>
    	<p></p>
    	</form>
    </div>
    {% endif %}

    <h3>Current users</h3>
    <table class="table">
        <thead>
            <tr>
                <th>Username</th>
                {% if ask_email %}<th>Email</th>{% endif %}
                <th>Has 2FA?</th>
                <th>Is authorized?</th>
                <th></th>
                <th></th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            {% if user.is_authorized %}
            <tr class="success" id={{ user.username }}>
                <td>{{ user.username }}</td>
                {% if ask_email %}<td>{{ user.email }}</td>{% endif %}
                <td>{{ user.has_2fa }}</td>
                <td>Yes</td>
                <td><a class="btn btn-default col-xs-10" href="{{ base_url }}authorize/{{ user.username }}" role="button">Unauthorize</a></td>
                <td><a class="btn btn-jupyter col-xs-10" href="{{ base_url }}change-password/{{ user.username }}" role="button">Change password</a></td>
                <td></td>
            </tr>
            {% else %}
            <tr id={{ user.username }}>
                <td>{{ user.username }}</td>
                {% if ask_email %}<td>{{ user.email }}</td>{% endif %}
                <td>{{ user.has_2fa }}</td>
                <td>No</td>
                <td><a class="btn btn-jupyter col-xs-10" href="{{ base_url }}authorize/{{ user.username }}" role="button">Authorize</a></td>
                <td><a class="btn btn-jupyter col-xs-10" href="{{ base_url }}change-password/{{ user.username }}" role="button">Change password</a></td>
                <td><a class="btn btn-jupyter col-xs-10" href="{{ base_url }}discard/{{ user.username }}" role="button">Discard</a></td>
            </tr>
            {% endif %}
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
